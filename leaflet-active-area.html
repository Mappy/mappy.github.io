<!DOCTYPE html>
<html lang="en">
<head>

        <title>Un plugin Leaflet pour le site Mappy (Leaflet-active-area)</title>
        <meta charset="utf-8" />
        <link href="https://techblog.mappy.com/feeds/rss.xml" type="application/atom+xml" rel="alternate" title="Mappy Labs Full Atom Feed" />
        <link href="https://techblog.mappy.com/feeds/web/rss.xml" type="application/atom+xml" rel="alternate" title="Mappy Labs Categories Atom Feed" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="./theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="./theme/style.css" />
        <link rel="stylesheet" type="text/css" href="./theme/pygment.css" />
        <link rel="icon" type="image/png" href="images/favicon-96x96.png" sizes="96x96">
        <link rel="icon" type="image/png" href="images/favicon-16x16.png" sizes="16x16">
        <link rel="icon" type="image/png" href="images/favicon-32x32.png" sizes="32x32">

</head>

<body id="index" class="home">


    <div class="container">

        <header id="banner" class="body">
            <h1><a href="/"><img src="/images/logo.png" /> Labs</a></h1>
            <div id="navigation" class="navbar row">
                <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
            </div>
        </header><!-- /#banner -->

        <div class="row">

<section id="content" class="body">

   <div class="row">
        <div class="ten columns">


            <header>
              <h2 class="entry-title">
                <a href="./leaflet-active-area.html" rel="bookmark"
                   title="Permalink to Un plugin Leaflet pour le site Mappy (Leaflet-active-area)">Un plugin Leaflet pour le site Mappy (Leaflet-active-area)</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="2015-02-16T00:00:00+01:00">
                Mon 16 February 2015
              </abbr>
              <address class="vcard author">
                By <a class="url fn" href="./author/gregory-paul.html">Grégory Paul</a>
              </address>
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <h1>Un plugin Leaflet pour le site mappy.com</h1>
<p>Lors de la mise en place de Leaflet sur mappy.com, (comme présenté dans un <a href="./mappy-com-migre-vers-leaflet.html">billet précédent</a>), nous avons eu l'occasion de développer un plugin Leaflet, proposé en open-source.</p>
<h3>Mise en avant de la carte</h3>
<p>L’un des objectifs de cette nouvelle version fût de mettre en avant la carte dans l’interface, qui n'occupait qu’une petite partie de l’interface de la version précédente. Ainsi, sur les pages de fiche POI ou sur la feuille de route, la carte occupe tout l’écran, du haut en bas de l’écran.</p>
<p>Cela est surtout visible sur les grandes résolutions, où chaque bord laisse place à la carte comme le témoignent les captures d’écran suivantes :</p>
<p><img alt="Itinéraire" src="images/leaflet-active-area/iti.png"></p>
<p><a href="http://fr.mappy.com/itineraire/Paris%2075001%20-%2075116/Vincennes%2094300?opt.vehicle=midcar&amp;opt.cost=time&amp;opt.notoll=0&amp;opt.infotraffic=0&amp;opt.gascost=1.558&amp;opt.gas=petrol&amp;opt.compensation=0&amp;routeidx=0">Feuille de route d’un itinéraire</a></p>
<p><img alt="Fiche POI" src="images/leaflet-active-area/poi.png"></p>
<p><a href="http://fr.mappy.com/poi/51f0bde784aebbc34d4a0cc7">Fiche POI</a></p>
<p>Comme on peut le voir sur les images ci-dessus, et vu que la carte occupe presque tout l’écran, les informations - marqueurs et polyline - ne sont pas centrées. Le centre de la carte correspond au centre de l’écran, caché derrière les éléments HTML.
Cela est plus visible lorsque l’on rend transparents ces éléments HTML comme le montrent les captures suivantes :</p>
<p><img alt="Itinéraire avec fond transparent" src="images/leaflet-active-area/iti-transparent.png"></p>
<p><a href="http://fr.mappy.com/itineraire/Paris%2075001%20-%2075116/Vincennes%2094300?opt.vehicle=midcar&amp;opt.cost=time&amp;opt.notoll=0&amp;opt.infotraffic=0&amp;opt.gascost=1.558&amp;opt.gas=petrol&amp;opt.compensation=0&amp;routeidx=0">Feuille de route d’un itinéraire avec fond transparent</a></p>
<p><img alt="Fiche POI avec fond transparent" src="images/leaflet-active-area/poi-transparent.png"></p>
<p><a href="http://fr.mappy.com/poi/51f0bde784aebbc34d4a0cc7">Fiche POI avec fond transparent</a></p>
<p>Les appels à l’API Leaflet (centrage de la carte, centrage de la vue en fonction de marqueurs, d’un itinéraire) vont naturellement avoir pour centre de la carte le centre de l’écran si celle-ci en occupe la quasi-totalité.</p>
<h3>Le plugin Leaflet-active-area</h3>
<p>Afin de pouvoir afficher des marqueurs ou un itinéraire de façon excentrée, nous avons développé un plugin Leaflet pour abstraire ce comportement.</p>
<p>Il s’agit du plugin <a href="https://github.com/Mappy/Leaflet-active-area">Leaflet-active-area</a> qui, comme le montre la <a href="http://techblog.mappy.com/Leaflet-active-area/examples/index.html">page d’exemple</a>, permet d’appeler les méthodes usuelles de Leaflet telles que setView, setZoom, fitBounds tout en "centrant" la carte à partir d’une autre zone.</p>
<p>Le principe est de définir une classe CSS, positionnée de façon absolue, qui sera prise en compte comme zone active de la carte. Ainsi, le centre de la carte sera le centre de cette zone et l’ensemble des marqueurs ou tracés y seront placés.</p>
<h3>Disponible sous license Apache 2.0</h3>
<p>Il nous a paru évident, utilisant une API open-source utilisée et développée par une énorme communité de développeurs, de proposer ce plugin en open-source. Il est disponible sur <a href="https://github.com/Mappy/Leaflet-active-area">github</a> et référencé dans <a href="http://leafletjs.com/plugins.html#other-plugins-and-libraries">“la page des plugins”</a> du site leaflet.</p>
<p>A ce jour, nous avons même reçu la contribution de plusieurs développeurs hors Mappy avec l'ouverture - et l'acceptation - de 4 pull requests, la création puis la résolution de plusieurs issues. N'hésitez pas à contribuer !</p>
            </div><!-- /.entry-content -->


        </div><!-- /.eleven.columns -->
        
<div class="four columns" id="sidebar">

<h4>Pages</h4>

 <ul>
  </ul>

<h4>Categories</h4>
<ul>
		<li><a href="./category/agile.html">Agile</a></li>
		<li><a href="./category/android.html">Android</a></li>
		<li><a href="./category/gis.html">GIS</a></li>
		<li><a href="./category/solr.html">Solr</a></li>
		<li><a href="./category/web.html">Web</a></li>
</ul>


<h4>Tags</h4>
	<ul>
	    <li class="tag-4"><a href="./tag/openlr.html">openlr</a></li>
	    <li class="tag-4"><a href="./tag/agilite.html">agilité</a></li>
	    <li class="tag-4"><a href="./tag/meetup.html">meetup</a></li>
	    <li class="tag-4"><a href="./tag/android.html">android</a></li>
	    <li class="tag-4"><a href="./tag/retrospective.html">rétrospective</a></li>
	    <li class="tag-3"><a href="./tag/leaflet.html">leaflet</a></li>
	    <li class="tag-2"><a href="./tag/nodejs.html">node.js</a></li>
	    <li class="tag-4"><a href="./tag/watch.html">watch</a></li>
	    <li class="tag-4"><a href="./tag/docker.html">docker</a></li>
	    <li class="tag-3"><a href="./tag/postgis.html">postGIS</a></li>
	    <li class="tag-4"><a href="./tag/panorama.html">panorama</a></li>
	    <li class="tag-3"><a href="./tag/mapnik.html">mapnik</a></li>
	    <li class="tag-1"><a href="./tag/opensource.html">opensource</a></li>
	    <li class="tag-2"><a href="./tag/english.html">english</a></li>
	    <li class="tag-2"><a href="./tag/webperfs.html">webperfs</a></li>
	    <li class="tag-4"><a href="./tag/opengl.html">opengl</a></li>
	    <li class="tag-4"><a href="./tag/responsive.html">responsive</a></li>
	    <li class="tag-4"><a href="./tag/python.html">python</a></li>
	    <li class="tag-1"><a href="./tag/francais.html">français</a></li>
	    <li class="tag-3"><a href="./tag/backbone.html">backbone</a></li>
	    <li class="tag-3"><a href="./tag/solr.html">solr</a></li>
	    <li class="tag-4"><a href="./tag/webgl.html">webgl</a></li>
	    <li class="tag-1"><a href="./tag/javascript.html">javascript</a></li>
	    <li class="tag-4"><a href="./tag/gis.html">GIS</a></li>
	    <li class="tag-4"><a href="./tag/livereload.html">livereload</a></li>
	    <li class="tag-4"><a href="./tag/browserify.html">browserify</a></li>
	    <li class="tag-4"><a href="./tag/abtest.html">abtest</a></li>
</ul>

<nav class="widget">
  <h4>Links</h4>
  <ul>
    <li><a href="https://www.mappy.com/">Mappy</a></li>
    <li><a href="https://play.google.com/store/apps/details?id=com.mappy.app">Appli Android</a></li>
    <li><a href="https://itunes.apple.com/fr/app/mappy-itineraire-et-recherche/id313834655?mt=8">Appli iOS</a></li>
    <li><a href="http://corporate.mappy.com">Blog Mappy</a></li>
    <li><a href="http://corporate.mappy.com/faq/integrez-mappy/">API Mappy</a></li>
  </ul>
</nav>


</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">


        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">

                <li><div class="btn primary"><a href="https://github.com/Mappy" target="_blank">Github</a></div></li>

                <li><div class="btn twitter"><a href="https://twitter.com/Mappy" target="_blank">Twitter</a></div></li>

                <li><div class="btn facebook"><a href="https://www.facebook.com/MappyOnline" target="_blank">Facebook</a></div></li>


              </ul>
            </div>
          </div>
        </footer>

    </div>

</body>
</html>